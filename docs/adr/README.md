# Architecture Decision Records (ADRs)

ADRs capture **design decisions** that are expensive to rediscover later.

They are intentionally not “how-to” docs. They answer:

- What decision did we make?
- Why?
- What alternatives did we reject?
- What are the consequences?

This repo is designed to be agent-friendly; ADRs are one of the highest-signal inputs for agents planning changes.

## When to write an ADR

Write an ADR when a change:

- affects a core contract (ReportIR, WorkGraph, Changesets, AgentRunSpec)
- changes the approval/safety model
- changes how Projects field sync is satisfied
- changes GitHub auth strategy (PAT vs App vs Actions token)
- introduces a new persistent store schema or migration approach
- changes the canonical source-of-truth (templates, workflows)
- affects how hierarchy/provenance is computed

Don’t write ADRs for:

- small refactors with no external behavior change
- purely local naming/formatting changes
- trivial bugfixes

## Directory layout

- `docs/adr/` — ADR markdown files
- `docs/adr/template.md` — the ADR template
- `docs/adr/INDEX.md` — generated index of ADRs and tags

## Naming convention

Recommended:

- `ADR-0001-<short-slug>.md`
- Increment IDs monotonically (no reuse)
- If you have an org-wide ADR prefix, you can use it, but keep the filename stable.

## Status values

Use one of:

- `Proposed`
- `Accepted`
- `Rejected`
- `Superseded by ADR-####`
- `Deprecated`

## Tags

Use tags to help agents find relevant ADRs quickly.

Suggested tag taxonomy:

- `contracts`
- `github`
- `projects`
- `auth`
- `safety`
- `idempotency`
- `tree`
- `ui`
- `db`
- `testing`
- `ops`
- `docs`

You can add more; keep them short and stable.

## Template

Use: `docs/adr/template.md`

## Generated index (INDEX.md)

`docs/adr/INDEX.md` is intended to be generated by a script that:

1. scans `docs/adr/*.md`
2. extracts ADR ID, status, date, tags, and title
3. produces:
   - a chronological list
   - a tag index (“tag → ADRs”)

This enables agents to read only relevant ADRs.

### Agent guidance

If you use an `AGENTS.md` file, recommended rule:

- Agents MUST read `docs/adr/INDEX.md` first.
- Then they MUST read any ADRs tagged with the change’s relevant areas.

## Superseding ADRs

When a decision changes:

- write a new ADR that supersedes the old one
- update the old ADR’s status to “Superseded by …”
- keep the old ADR for history

