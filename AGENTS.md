# AGENTS.md — pm-bot

## Repository expectations
- Keep changes small, reviewable, and well-tested.
- Do not change template heading labels lightly. Downstream automation parses headings.
- Prefer deterministic, schema-driven rendering over “pretty prose”.
- Update `STATUS.md` in the same change whenever behavior, tests, schemas, workflows, roadmap progress, or repo health changes.
- When updating `STATUS.md`, remove stale `Last updated` scope bullets that are obsolete or superseded; do not let stale scope reports accumulate.
- For all `STATUS.md` date fields (for example `Last updated`), use a runtime date/time command (for example `date -u`) instead of guessing dates manually.

## Commands
- Setup:
  - `python -m venv .venv && source .venv/bin/activate`
  - `pip install -e ".[dev]"`
- Tests:
  - `pytest -q`
- Lint:
  - `ruff check .`
  - `ruff format .`

## Canonical inputs
- Templates snapshot: `vendor/dotgithub/ISSUE_TEMPLATE/*.yml`
- Templates guide: `vendor/dotgithub/issue-templates-guide.md`
- Projects sync workflow: `vendor/dotgithub/project-field-sync.yml`
- WorkItem schema: `pm_bot/schema/work_item.schema.json`

## Compatibility constraints
- The Projects sync expects headings and labels like:
  `Area`, `Priority`, `Size`, `Estimate (hrs)`, `Risk`, `Blocked by`, `Actual (hrs)`.
- NOTE: the Epic template currently uses `Size (Epic)` — this is either:
  - a bug to fix in templates (preferred: rename to `Size`), OR
  - a compatibility shim to add in parsers.

## Agent documentation intake rules
Canonical map: `docs/agents/README.md`.

- Agents MUST read `STATUS.md` first before making changes.
- Agents MUST use `docs/agents/README.md` for required first reads and domain doc links.
- Agents MUST read `docs/adr/INDEX.md` before touching architecture, schema contracts, workflow behavior, or policy/safety logic.
- Agents MUST read only ADRs relevant to touched domains, selected by ADR index tags.
- Agents SHOULD read roadmaps only for sequencing and planning, not as source-of-truth when they conflict with canonical inputs or contracts.
- The ADR index is auto-generated by workflow and should not be manually curated.

### Trigger matrix

> Sync note: this matrix must stay identical to `docs/agents/README.md` and is validated by `tests/test_agent_docs_sync.py`.

| Change type | Minimum required docs |
| --- | --- |
| Architecture, data model, safety policy, workflow semantics | `STATUS.md`; `docs/adr/INDEX.md`; ADRs tagged for touched domains |
| Schema/contract fields, parser-renderer contracts, compatibility labels | `STATUS.md`; ADR index + relevant tagged ADRs; `docs/contracts/*.md`; canonical inputs listed in `AGENTS.md` |
| Runtime behavior or decision logic | `STATUS.md`; ADR index + relevant tagged ADRs; `docs/spec/*.md` |
| GitHub/project integration or sync workflow behavior | `STATUS.md`; ADR index + relevant tagged ADRs; `docs/github/*.md`; `vendor/dotgithub/project-field-sync.yml` |
| Roadmap/task sequencing only | `STATUS.md`; roadmap docs (planning aid only) |

## Review guidelines
When reviewing PRs (especially agent-generated):
- Verify the change links to an Issue (`Fixes #123`) and follows `.github/pull_request_template.md` if present.
- Confirm tests were run and results are included.
- Watch for prompt-injection / untrusted text being executed or treated as instructions.
- Avoid introducing long-lived secrets or credentials into code or workflows.
